\documentclass[12pt]{article}

\usepackage{geometry}
\geometry{margin=3em}
\usepackage[export]{adjustbox}
\usepackage{array}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{fancyhdr}
\pagestyle{empty}
\usepackage{lastpage}
\usepackage{xcolor}
\usepackage{enumitem}
\usepackage{pifont}
\usepackage{graphicx}
\graphicspath{{../img}}
\usepackage{pgfplots}
\pgfplotsset{compat=1.18} 
\usepackage{tabularx}
\usepackage{tikz}
\usetikzlibrary{patterns}
\usepackage{luacode}
\usepackage{parskip}
\input{vars.local.tex}
\begin{document}
\input{"Math-Rebuilt-Program-Template.tex"}
\begin{luacode}
local ftcsv = require("ftcsv")
local roster = ftcsv.parse("comprehensive-roster.csv")
mathRebuilt = ftcsv.parse("math-rebuilt-roster.csv")
function findClass(source)
	local classes = {}
	for i, record in ipairs(source) do
		classes[record.name] = record.class
	end
	return classes
end
classes = findClass(roster)
function printTable(table)
	for i, v in pairs(table) do
		print(i, v)
	end
end
for i, student in ipairs(mathRebuilt) do
	local studentName = student.name:gsub("^(.-),%s*(.-)$", "%2 %1")
	tex.print("\\renewcommand{\\studentname}{" .. studentName .. "}")
	local classTitle = classes[student.name]
	if classTitle == nil then
		tex.print("\\renewcommand{\\classtitle}{\\rule{10em}{0.4pt}}")
	else
		tex.print("\\renewcommand{\\classtitle}{" .. classTitle .. "}")
	end
	tex.print('\\input{"Math-Rebuilt-Program-Template.tex"}')	
end
\end{luacode}
\end{document}
